extends layout

block content
  .container.mx-auto.px-4.py-8
    if activeTrip
      .flex.justify-between.items-center.mb-8
        h1.text-2xl.font-bold.text-white Riders
        a(href="/add-rider" class="bg-blue-600 hover:bg-blue-700 text-white font-bold py-2 px-4 rounded-lg shadow transition-colors")
          i.fas.fa-plus.mr-2
          | Add Rider

      if riders && riders.length > 0
        .bg-gray-900.rounded-lg.shadow-lg.overflow-hidden.mb-8
          table.min-w-full
            thead
              tr.bg-gray-800.text-gray-300.text-left
                th.py-3.px-4 Name
                th(class="py-3 px-4 hidden md:table-cell") Collected
                th(class="py-3 px-4 hidden md:table-cell") Balance Due
                th(class="py-3 px-4 text-right hidden md:table-cell") Actions
            tbody
              each rider in riders
                tr.border-t.border-gray-800.group
                  // Mobile: Entire row clickable
                  td(class="py-3 px-4 cursor-pointer md:cursor-default" onclick=`window.location.href='/edit-rider/${rider.id}'`)
                    .flex.items-center(class=rider.rider_cancelled ? "text-gray-500" : "text-white")
                      span= rider.name
                      if rider.instructions_sent
                        i.fas.fa-check.text-green-500.ml-2
                      if rider.has_emergency_contacts
                        i.fas.fa-ambulance.text-red-500.ml-2
                      if rider.rider_cancelled
                        i.fas.fa-times.text-red-700.ml-2
                    if rider.congregation
                      .text-sm.text-gray-400= rider.congregation
                    // Mobile-only summary info
                    div(class="md:hidden text-sm text-gray-400 mt-1")
                      .flex.justify-between
                        span Balance Due: $#{rider.balance}
                      .flex.justify-between.mt-1
                        span Collected: #{rider.collected}
                      // Mobile-only actions
                      .flex.justify-end.mt-2.space-x-2
                        a(href=`/rider/${rider.id}/payments` class="bg-blue-600 text-white text-sm px-3 py-1 rounded-lg hover:bg-blue-700") View Payments

                  // Desktop-only columns
                  td(class="py-3 px-4 text-white hidden md:table-cell")= rider.collected
                  td(class="py-3 px-4 text-white hidden md:table-cell") $#{rider.balance}
                  td(class="py-3 px-4 text-right hidden md:table-cell")
                    a(href=`/rider/${rider.id}/payments` class="text-blue-400 hover:text-blue-300") Payments
      else
        .text-center.text-gray-400.py-8 No riders found for this trip.

      // Trip Summary Section - Smaller and at bottom
      .bg-gray-900.rounded-lg.p-4.shadow-lg
        .flex.items-center.justify-between.mb-4
          h2.text-lg.font-semibold.text-white #{activeTrip.name}
          span.text-sm.text-gray-400 #{activeTrip.start_date} - #{activeTrip.end_date}
        
        div(class="grid grid-cols-2 md:grid-cols-4 gap-4 text-sm")
          div(class="bg-gray-800 rounded p-3")
            .text-gray-400 Reserved/Total Seats
            .font-bold.text-white #{RESERVED_SEATS}/#{TOTAL_SEATS}
          div(class="bg-gray-800 rounded p-3")
            .text-gray-400 Available Seats
            .font-bold.text-white #{REMAINING_SEATS}
          div(class="bg-gray-800 rounded p-3")
            .text-gray-400 Total Collected
            .font-bold.text-white #{TOTAL_COLLECTED}
          div(class="bg-gray-800 rounded p-3")
            .text-gray-400 Remaining Funds
            .font-bold.text-white #{REMAINING_FUNDS}

    else
      .bg-yellow-600.text-white.p-4.rounded-lg.shadow-lg.mb-8
        .flex.items-center
          i.fas.fa-exclamation-triangle.mr-2
          | No active trip selected. 
          a(href="/trips" class="underline ml-2") Select a trip
