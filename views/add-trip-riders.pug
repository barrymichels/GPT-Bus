extends layout

block content
  .container.mx-auto.px-4.py-8
    .max-w-4xl.mx-auto
      h1.text-2xl.font-bold.text-white.mb-8 Add Riders to #{trip.name}
      
      form(action=`/trip/${trip.id}/add-riders` method="POST")
        //- Select All header
        .bg-gray-800.rounded-t-lg.p-4.border-b.border-gray-700
          label.inline-flex.items-center.cursor-pointer
            input#selectAll(type="checkbox" class="form-checkbox h-5 w-5 text-blue-500 rounded")
            span.ml-3.text-white.font-medium Select All

        //- Desktop: Table view
        div(class="bg-gray-900 rounded-b-lg shadow-lg overflow-hidden mb-8 hidden md:block")
          table.min-w-full(aria-label="Available riders")
            thead
              tr.bg-gray-800.text-gray-300.text-left
                th.py-3.px-4.w-12(scope="col")
                  span.sr-only Select
                th.py-3.px-4(scope="col") Name
                th.py-3.px-4(scope="col") Email
            tbody
              each rider in availableRiders
                tr(class="border-t border-gray-800 hover:bg-gray-800 transition-colors")
                  td.py-3.px-4
                    input(
                      type="checkbox" 
                      name=`selected_riders[${rider.id}]`
                      value=rider.id
                      id=`rider-${rider.id}`
                      class="form-checkbox h-5 w-5 text-blue-500 rounded rider-checkbox"
                      aria-label=`Select ${rider.name}`
                    )
                  td.py-3.px-4.text-white
                    label(for=`rider-${rider.id}`)= rider.name
                  td.py-3.px-4.text-gray-400= rider.email || '-'

        //- Mobile: Card view
        div(class="md:hidden space-y-2 mb-8")
          each rider in availableRiders
            .bg-gray-900.rounded-lg.p-4.border.border-gray-700
              label.flex.items-center.cursor-pointer
                input(
                  type="checkbox" 
                  name=`selected_riders[${rider.id}]`
                  value=rider.id
                  class="form-checkbox h-5 w-5 text-blue-500 rounded rider-checkbox flex-shrink-0"
                  aria-label=`Select ${rider.name}`
                )
                .ml-4
                  .text-white.font-medium= rider.name
                  if rider.email
                    .text-gray-400.text-sm= rider.email
        
        .flex.justify-end.space-x-4
          a(href="/trips" class="px-4 py-2 bg-gray-600 text-white rounded-lg hover:bg-gray-700 transition-colors") Cancel
          button(type="submit" class="px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors") Add Selected Riders

  script.
    document.addEventListener('DOMContentLoaded', () => {
      const selectAll = document.getElementById('selectAll');
      const checkboxes = document.querySelectorAll('.rider-checkbox');
      
      selectAll.addEventListener('change', () => {
        checkboxes.forEach(checkbox => {
          checkbox.checked = selectAll.checked;
        });
      });

      // Update selectAll state when individual checkboxes change
      checkboxes.forEach(checkbox => {
        checkbox.addEventListener('change', () => {
          const allChecked = Array.from(checkboxes).every(cb => cb.checked);
          const someChecked = Array.from(checkboxes).some(cb => cb.checked);
          selectAll.checked = allChecked;
          selectAll.indeterminate = someChecked && !allChecked;
        });
      });
    });
