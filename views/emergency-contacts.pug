extends layout

block content
  .container.mx-auto.px-4.py-8
    .max-w-2xl.mx-auto
      h1.text-3xl.font-bold.text-white.mb-2 Emergency Contacts
      h2.text-xl.text-gray-300.mb-6 #{rider.name}#{rider.congregation ? ` - ${rider.congregation}` : ''}
      
      if error
        .bg-red-500.text-white.p-4.rounded-lg.mb-6= error
      
      form(action=`/rider/${riderId}/emergency-contacts` method="POST")
        // Primary Contact
        div(class="bg-gray-700 p-6 rounded-lg shadow-lg mb-6")
          h2.text-xl.font-bold.text-white.mb-4 Primary Emergency Contact
          div(class="grid grid-cols-1 md:grid-cols-2 gap-4")
            .form-group.col-span-2
              label(for="contact1_name" class="block text-sm font-medium text-gray-300") Full Name
              input#contact1_name(
                type="text"
                name="contact1_name"
                value=contact1.name
                required
                class="mt-1 block w-full bg-gray-600 border border-gray-500 rounded-lg shadow-sm py-2 px-3 text-white"
              )
            .form-group.col-span-2
              label(for="contact1_relationship" class="block text-sm font-medium text-gray-300") Relationship
              input#contact1_relationship(
                type="text"
                name="contact1_relationship"
                value=contact1.relationship
                required
                class="mt-1 block w-full bg-gray-600 border border-gray-500 rounded-lg shadow-sm py-2 px-3 text-white"
              )
            .form-group.col-span-2
              label(for="contact1_phone" class="block text-sm font-medium text-gray-300") Mobile Phone
              input#contact1_phone(
                type="tel"
                name="contact1_phone"
                value=contact1.phone
                required
                class="mt-1 block w-full bg-gray-600 border border-gray-500 rounded-lg shadow-sm py-2 px-3 text-white"
              )
            .form-group.col-span-2
              label(for="contact1_other_phone" class="block text-sm font-medium text-gray-300") Other Phone
              input#contact1_other_phone(
                type="tel"
                name="contact1_other_phone"
                value=contact1.other_phone
                class="mt-1 block w-full bg-gray-600 border border-gray-500 rounded-lg shadow-sm py-2 px-3 text-white"
              )

        // Secondary Contact
        div(class="bg-gray-700 p-6 rounded-lg shadow-lg mb-6")
          h2.text-xl.font-bold.text-white.mb-4 Secondary Emergency Contact (Optional)
          div(class="grid grid-cols-1 md:grid-cols-2 gap-4")
            .form-group.col-span-2
              label(for="contact2_name" class="block text-sm font-medium text-gray-300") Full Name
              input#contact2_name(
                type="text"
                name="contact2_name"
                value=contact2.name
                class="mt-1 block w-full bg-gray-600 border border-gray-500 rounded-lg shadow-sm py-2 px-3 text-white"
                oninput="toggleRequired(2)"
              )
            .form-group.col-span-2
              label(for="contact2_relationship" class="block text-sm font-medium text-gray-300") Relationship
              input#contact2_relationship(
                type="text"
                name="contact2_relationship"
                value=contact2.relationship
                class="mt-1 block w-full bg-gray-600 border border-gray-500 rounded-lg shadow-sm py-2 px-3 text-white"
                data-contact="2"
              )
            .form-group.col-span-2
              label(for="contact2_phone" class="block text-sm font-medium text-gray-300") Mobile Phone
              input#contact2_phone(
                type="tel"
                name="contact2_phone"
                value=contact2.phone
                class="mt-1 block w-full bg-gray-600 border border-gray-500 rounded-lg shadow-sm py-2 px-3 text-white"
                data-contact="2"
              )
            .form-group.col-span-2
              label(for="contact2_other_phone" class="block text-sm font-medium text-gray-300") Other Phone
              input#contact2_other_phone(
                type="tel"
                name="contact2_other_phone"
                value=contact2.other_phone
                class="mt-1 block w-full bg-gray-600 border border-gray-500 rounded-lg shadow-sm py-2 px-3 text-white"
              )

        // Medical Notes
        div(class="bg-gray-700 p-6 rounded-lg shadow-lg mb-6")
          h2.text-xl.font-bold.text-white.mb-4 Medical Information
          .form-group
            label(for="medical_notes" class="block text-sm font-medium text-gray-300") Notes for EMT/Medical Personnel
            textarea#medical_notes(
              name="medical_notes"
              rows="4"
              class="mt-1 block w-full bg-gray-600 border border-gray-500 rounded-lg shadow-sm py-2 px-3 text-white"
            )= medical_notes

        .flex.justify-end.space-x-4
          a(href=`/edit-rider/${riderId}` class="px-4 py-2 bg-gray-600 text-white rounded-lg hover:bg-gray-700 transition-colors") Cancel
          button(type="submit" class="px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors") Save Changes

  script.
    function toggleRequired(contactNum) {
      const nameInput = document.getElementById(`contact${contactNum}_name`);
      const fields = document.querySelectorAll(`[data-contact="${contactNum}"]`);
      
      fields.forEach(field => {
        if (nameInput.value.trim()) {
          field.required = true;
          field.classList.add('border-yellow-500');
        } else {
          field.required = false;
          field.classList.remove('border-yellow-500');
        }
      });
    }

    // Initialize on page load
    document.addEventListener('DOMContentLoaded', () => {
      toggleRequired(2);
    });
